# ============================================
# Eddy USB – angepasste Config für 300x300
# ============================================

[mcu eddy]
#serial: /dev/serial/by-id/usb-Klipper_rp2040_eddy-if00    # mit ls /dev/serial/by-id prüfen[file:145]
canbus_uuid: 10afd2d612d2

[temperature_sensor btt_eddy_mcu]
sensor_type: temperature_mcu
sensor_mcu: eddy
min_temp: 10
max_temp: 100

[probe_eddy_current btt_eddy]
sensor_type: ldc1612
z_offset: 2.5                  # Platzhalter, später PROBE_CALIBRATE
#i2c_address:
i2c_mcu: eddy                  # Eddy USB eigens I2C-MCU[file:145]
i2c_bus: i2c0f
# X/Y-Offset relativ zur Düse; 0/21.42 ist Voron-Stealthburner-Standard
x_offset: 0
y_offset: 21.42

[bed_mesh]
horizontal_move_z: 2
speed: 200
# Für 300x300 Bett: Innenbereich so wählen, dass die Probe überall hinkommt
mesh_min: 15, 15              # leicht vom Rand weg[file:145]
mesh_max: 285, 285            # 300 - 15, bei x_offset≈0/y_offset≈21.42 passt das
probe_count: 9, 9
algorithm: bicubic
#scan_overshoot: 8            # optional, wenn X-Weg reicht

# Optional, wenn du Eddy als Z-Endstop UND Auto-Safe-Home nutzen willst
[safe_z_home]
home_xy_position: 150, 150   # Bettmitte bei 300x300
z_hop: 10
z_hop_speed: 25
speed: 200

[gcode_macro SET_GCODE_OFFSET]
rename_existing: SET_GCODE_OFFSET_ORIG
variable_restored: False
variable_runtime_offset: 0
gcode:
  SET_GCODE_OFFSET_ORIG { rawparams }

[gcode_macro PROBE_EDDY_CURRENT_CALIBRATE_AUTO]
gcode:
  BED_MESH_CLEAR
  G28 X Y
  G90
  G1 X{ printer.toolhead.axis_maximum.x/2 } \
     Y{ printer.toolhead.axis_maximum.y/2 } F6000
  {% if 'z' not in printer.toolhead.homed_axes %}
    SET_KINEMATIC_POSITION Z={ printer.toolhead.axis_maximum.z-1 }
  {% endif %}
  PROBE_EDDY_CURRENT_CALIBRATE {rawparams}
